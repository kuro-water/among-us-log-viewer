<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Among Us ゲーム履歴ビューワー</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="style.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    </head>
    <body>
        <header>
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col">
                        <h1>🎮 Among Us ゲーム履歴ビューワー</h1>
                        <p class="mb-0" style="color: rgba(255, 255, 255, 0.9); font-size: 0.95rem">
                            ゲーム統計分析 & ビジュアルダッシュボード
                        </p>
                    </div>
                </div>
            </div>
        </header>

        <div class="container-fluid">
            <!-- アップロードセクション -->
            <div class="card" id="uploadCard">
                <div class="card-header"><span class="icon">📁</span> ゲーム履歴ファイルの読み込み</div>
                <div class="card-body">
                    <div class="upload-zone" id="uploadZone">
                        <div class="icon-size">📤</div>
                        <p class="mb-2"><strong>game_history.jsonlをここにドラッグ&ドロップ</strong></p>
                        <p class="text-muted">または下のボタンをクリックして選択</p>
                        <input type="file" id="fileInput" accept=".jsonl" style="display: none" />
                        <button class="btn btn-primary mt-3" onclick="document.getElementById('fileInput').click()">
                            ファイルを選択
                        </button>
                    </div>
                    <div id="uploadStatus" class="mt-3"></div>
                </div>
            </div>

            <!-- ダッシュボード（デフォルトは非表示） -->
            <div id="dashboard" style="display: none">
                <!-- サマリーカード -->
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-box">
                            <div class="stat-label">総ゲーム数</div>
                            <div class="stat-value" id="totalGames">0</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-box">
                            <div class="stat-label">プレイヤー数</div>
                            <div class="stat-value" id="totalPlayers">0</div>
                        </div>
                    </div>
                </div>

                <!-- フィルタリング -->
                <div class="card mb-4">
                    <div class="card-header">🔍 フィルタリング</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">開始日時</label>
                                <input type="datetime-local" id="filterStartDate" class="form-control" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">終了日時</label>
                                <input type="datetime-local" id="filterEndDate" class="form-control" />
                            </div>
                            <div class="col-md-12" style="display: flex; align-items: flex-end; gap: 10px">
                                <select id="quickFilterSelect" class="form-select" style="flex: 1">
                                    <option value="">直近時間を選択...</option>
                                    <option value="3">直近3時間</option>
                                    <option value="6">直近6時間</option>
                                    <option value="12">直近12時間</option>
                                    <option value="24">直近24時間</option>
                                    <option value="48">直近2日</option>
                                    <option value="72">直近3日</option>
                                    <option value="96">直近4日</option>
                                    <option value="120">直近5日</option>
                                    <option value="144">直近6日</option>
                                    <option value="168">直近7日</option>
                                    <option value="720">直近30日</option>
                                </select>
                                <button class="btn btn-primary" onclick="applyFilters()" style="flex: 1">
                                    フィルターを適用
                                </button>
                                <button class="btn btn-secondary" onclick="clearFilters()" style="flex: 1">
                                    リセット
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- タブナビゲーション -->
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button
                            class="nav-link active"
                            id="overview-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#overview"
                            role="tab"
                        >
                            📊 概要
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button
                            class="nav-link"
                            id="players-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#players"
                            role="tab"
                        >
                            🎮 プレイヤー統計
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="roles-tab" data-bs-toggle="tab" data-bs-target="#roles" role="tab">
                            🎯 ロール分析
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" role="tab">
                            📋 ゲーム一覧
                        </button>
                    </li>
                </ul>

                <div class="tab-content mt-4">
                    <!-- 概要タブ -->
                    <div class="tab-pane fade show active" id="overview" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">🏆 勝利数ランキング</div>
                                    <div class="card-body">
                                        <ol id="winsRanking" style="list-style: none; padding: 0"></ol>
                                        <div class="chart-container" style="max-width: 300px; margin: 2rem auto">
                                            <canvas id="winsRankingChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">⭐ 勝率ランキング（3ゲーム以上）</div>
                                    <div class="card-body">
                                        <ol id="winRateRanking" style="list-style: none; padding: 0"></ol>
                                        <div class="chart-container" style="max-width: 300px; margin: 2rem auto">
                                            <canvas id="winRateRankingChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- プレイヤー統計タブ -->
                    <div class="tab-pane fade" id="players" role="tabpanel">
                        <div class="card">
                            <div class="card-header">プレイヤー別統計</div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="playerStatsTable">
                                        <thead>
                                            <!-- ヘッダーはscript.jsで動的生成 -->
                                        </thead>
                                        <tbody id="playerStatsBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ロール分析タブ -->
                    <div class="tab-pane fade" id="roles" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">ロール別勝率分析</div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="roleAnalysisChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">ロール統計</div>
                                    <div class="card-body" id="roleStatsDetails"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ゲーム一覧タブ -->
                    <div class="tab-pane fade" id="games" role="tabpanel">
                        <div class="card">
                            <div class="card-header">ゲーム一覧</div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover table-sm" id="gamesTable">
                                        <thead>
                                            <tr>
                                                <th>マップ</th>
                                                <th>プレイヤー数</th>
                                                <th>勝者チーム</th>
                                                <th>勝利メンバー</th>
                                                <th>ゲーム時間</th>
                                                <th>参加プレイヤー</th>
                                                <th>役職情報</th>
                                                <th>開始時刻</th>
                                            </tr>
                                        </thead>
                                        <tbody id="gamesBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Among Us ゲーム履歴ビューワー v1.0 | オフラインで完全に動作します</p>
        </div>

        <!-- ローディングスピナー -->
        <div class="spinner-overlay" id="spinner">
            <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">読み込み中...</span>
            </div>
        </div>

        <!-- トースト通知 -->
        <div class="toast-container" id="toastContainer"></div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="script.js"></script>
    </body>
</html>
