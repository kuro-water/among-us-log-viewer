<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMONG US ゲーム統計分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-4xl font-bold mb-2">AMONG US ゲーム統計分析</h1>
            <p class="text-gray-600">プレイヤーとロールの詳細な統計情報</p>
        </header>
        
        <!-- フィルターセクション -->
        <div class="card mb-6">
            <h2 class="section-title">フィルター</h2>
            <div class="filter-section">
                <div class="filter-group">
                    <label>開始日時</label>
                    <input type="datetime-local" id="startDate">
                </div>
                <div class="filter-group">
                    <label>終了日時</label>
                    <input type="datetime-local" id="endDate">
                </div>
                <div class="filter-group">
                    <label>最近のゲーム数</label>
                    <div class="preset-buttons">
                        <button class="btn-secondary" onclick="setRecentGames(10)">最新10</button>
                        <button class="btn-secondary" onclick="setRecentGames(20)">最新20</button>
                        <button class="btn-secondary" onclick="setRecentGames(50)">最新50</button>
                        <button class="btn-secondary" onclick="setRecentGames(100)">最新100</button>
                    </div>
                </div>
                <div class="filter-group">
                    <label>カスタム数</label>
                    <input type="number" id="customGameCount" placeholder="ゲーム数を入力" min="1">
                </div>
                <div class="filter-group">
                    <button class="btn-primary w-full" onclick="applyFilters()">フィルター適用</button>
                </div>
                <div class="filter-group">
                    <button class="btn-secondary w-full" onclick="resetFilters()">リセット</button>
                </div>
            </div>
        </div>
        
        <!-- 統計概要 -->
        <div class="card mb-6">
            <h2 class="section-title">統計概要</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600" id="totalGames">0</div>
                    <div class="text-sm text-gray-600">総ゲーム数</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600" id="totalPlayers">0</div>
                    <div class="text-sm text-gray-600">総プレイヤー数</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600" id="totalRoles">0</div>
                    <div class="text-sm text-gray-600">総ロール数</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-orange-600" id="avgGameLength">0</div>
                    <div class="text-sm text-gray-600">平均ゲーム時間(分)</div>
                </div>
            </div>
        </div>
        
        <!-- チャートセクション -->
        <div class="stats-grid">
            <!-- プレイヤー勝率ランキング -->
            <div class="card">
                <h2 class="section-title">プレイヤー勝率ランキング</h2>
                <div class="chart-container">
                    <canvas id="playerWinRateChart"></canvas>
                </div>
            </div>
            
            <!-- ロール勝率ランキング -->
            <div class="card">
                <h2 class="section-title">ロール勝率ランキング</h2>
                <div class="chart-container">
                    <canvas id="roleWinRateChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- 勝利チーム分布 -->
        <div class="card mb-6">
            <h2 class="section-title">勝利チーム分布</h2>
            <div class="chart-container" style="height: 350px;">
                <canvas id="winnerTeamChart"></canvas>
            </div>
        </div>
        
        <!-- プレイヤー×役職 ヒートマップ -->
        <div class="card mb-6">
            <h2 class="section-title">プレイヤー×役職 プレイ回数&勝率</h2>
            <div class="mb-4 text-sm text-gray-600">
                <span class="font-semibold">表示:</span> 上段: プレイ回数 / 下段: 勝率(%)
            </div>
            
            <!-- 凡例 -->
            <div class="heatmap-legend mb-4">
                <div class="font-semibold text-gray-700">色の意味（勝率）:</div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(135, 58%, 63%);"></div>
                    <span class="text-sm font-medium">70%以上（優秀）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(100, 55%, 65%);"></div>
                    <span class="text-sm font-medium">55-70%（良好）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(200, 62%, 65%);"></div>
                    <span class="text-sm font-medium">45-55%（平均）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(38, 78%, 63%);"></div>
                    <span class="text-sm font-medium">30-45%（課題あり）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(25, 82%, 62%);"></div>
                    <span class="text-sm font-medium">1-30%（要改善）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color-box" style="background: hsl(0, 72%, 64%);"></div>
                    <span class="text-sm font-medium">0%（未勝利）</span>
                </div>
                <div class="font-semibold text-gray-700 ml-4">※色が濃いほどプレイ回数多</div>
            </div>
            
            <div class="text-sm text-gray-500 mb-2 italic">
                💡 ヒント: 横にスクロールして全ての役職を表示できます
            </div>
            
            <div class="heatmap-scroll-container">
                <div id="heatmapContainer"></div>
            </div>
        </div>
        
        <!-- プレイヤー統計テーブルと役職統計テーブル -->
        <div class="stats-grid mb-6">
            <div class="card">
                <h2 class="section-title">プレイヤー統計</h2>
                <div class="overflow-x-auto">
                    <table id="playerStatsTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('playerStatsTable', 0)">プレイヤー名</th>
                                <th onclick="sortTable('playerStatsTable', 1)">勝率 (%)</th>
                                <th onclick="sortTable('playerStatsTable', 2)">タスク完了率 (%)</th>
                                <th onclick="sortTable('playerStatsTable', 3)">勝利数</th>
                                <th onclick="sortTable('playerStatsTable', 4)">総ゲーム数</th>
                            </tr>
                        </thead>
                        <tbody id="playerStatsBody">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h2 class="section-title">役職統計</h2>
                <div class="overflow-x-auto">
                    <table id="roleStatsTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('roleStatsTable', 0)">役職名</th>
                                <th onclick="sortTable('roleStatsTable', 1)">勝率 (%)</th>
                                <th onclick="sortTable('roleStatsTable', 2)">勝利数</th>
                                <th onclick="sortTable('roleStatsTable', 3)">総ゲーム数</th>
                            </tr>
                        </thead>
                        <tbody id="roleStatsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
