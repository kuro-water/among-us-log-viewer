(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67585,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let l=e.r(32061);function s({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new l.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,a)=>{"use strict";function l(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"encodeURIPath",{enumerable:!0,get:function(){return l}})},52157,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"PreloadChunks",{enumerable:!0,get:function(){return i}});let l=e.r(43476),s=e.r(74080),r=e.r(63599),n=e.r(9885);function i({moduleIds:e}){if("undefined"!=typeof window)return null;let t=r.workAsyncStorage.getStore();if(void 0===t)return null;let a=[];if(t.reactLoadableManifest&&e){let l=t.reactLoadableManifest;for(let t of e){if(!l[t])continue;let e=l[t].files;a.push(...e)}}return 0===a.length?null:(0,l.jsx)(l.Fragment,{children:a.map(e=>{let a=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,l.jsx)("link",{precedence:"dynamic",href:a,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,s.preload)(a,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return d}});let l=e.r(43476),s=e.r(71645),r=e.r(67585),n=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},a=(0,s.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,l.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?s.Suspense:s.Fragment,m=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,l.jsx)(a,{...e})]}):(0,l.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(a,{...e})});return(0,l.jsx)(c,{...o?{fallback:i}:{},children:m})}return c.displayName="LoadableComponent",c}},70703,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"default",{enumerable:!0,get:function(){return s}});let l=e.r(55682)._(e.r(69093));function s(e,t){let a={};"function"==typeof e&&(a.loader=e);let s={...a,...t};return(0,l.default)({...s,modules:s.loadableGenerated?.modules})}("function"==typeof a.default||"object"==typeof a.default&&null!==a.default)&&void 0===a.default.__esModule&&(Object.defineProperty(a.default,"__esModule",{value:!0}),Object.assign(a.default,a),t.exports=a.default)},31713,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let l=/\r?\n/;function s(e,t,a){let l=e.trim();if(!l)return null;try{return JSON.parse(l)}catch(s){let e=s instanceof Error?s:Error(String(s));return a.push({lineNumber:t,line:l,error:e}),null}}async function r(e,t){let a=[],r=[],n=new TextDecoder,i="",o=0,d=0;for(;;){let{value:c,done:m}=await e.read();if(m)break;if(c){d+=c.byteLength,t?.(d);let e=(i+=n.decode(c,{stream:!0})).split(l);for(let t of(i=e.pop()??"",e)){let e=s(t,o+=1,r);e&&a.push(e)}}}if(i.trim()){let e=s(i,o+=1,r);e&&a.push(e)}return{games:a,errors:r}}async function n(e={}){let t,a,{path:i="game_history_sample.jsonl",signal:o,onProgress:d}=e,c=await fetch(i,{cache:"no-store",signal:o});if(!c.ok)throw Error(`Failed to load game history (${c.status} ${c.statusText})`);return c.body?r(c.body.getReader(),d):(t=[],a=[],(await c.text()).split(l).forEach((e,l)=>{let r=s(e,l+1,a);r&&t.push(r)}),{games:t,errors:a})}var i=e.i(58278),o=e.i(26375),d=e.i(27302);let c=Object.keys(o.FACTION_CONFIG);var m=e.i(86364);let u=Object.keys(o.FACTION_CONFIG),p=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},h=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim();var g={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:r="",children:n,iconNode:i,...o},d)=>(0,a.createElement)("svg",{ref:d,...g,width:t,height:t,stroke:e,strokeWidth:s?24*Number(l)/Number(t):l,className:h("lucide",r),...!n&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...i.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(n)?n:[n]])),x=(e,t)=>{let l=(0,a.forwardRef)(({className:l,...s},r)=>(0,a.createElement)(f,{ref:r,iconNode:t,className:h(`lucide-${p(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,l),...s}));return l.displayName=p(e),l},y=x("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),b=x("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),v=x("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),j=x("flame",[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]]),w=x("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),N=x("radiation",[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 15.4641a4 4 0 0 1-4 0L7.52786 19.74597 A 1 1 0 0 0 7.99303 21.16211 10 10 0 0 0 16.00697 21.16211 1 1 0 0 0 16.47214 19.74597z",key:"1y4lzb"}],["path",{d:"M16 12a4 4 0 0 0-2-3.464l2.472-4.282a1 1 0 0 1 1.46-.305 10 10 0 0 1 4.006 6.94A1 1 0 0 1 21 12z",key:"163ggk"}],["path",{d:"M8 12a4 4 0 0 1 2-3.464L7.528 4.254a1 1 0 0 0-1.46-.305 10 10 0 0 0-4.006 6.94A1 1 0 0 0 3 12z",key:"1l9i0b"}]]),k=x("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),C=x("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),_=x("skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]),M={Reactor:N,O2:x("wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]),Lights:x("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Communications:k,CrashCourse:y,Mushroom:j,Door:C,Kill:_,Task:v,Meeting:w,Emergency:b,Default:w},A={Reactor:"#ff4d6d",O2:"#00b4d8",Lights:"#f9a826",Communications:"#4cc9f0",CrashCourse:"#c77dff",Mushroom:"#ffafcc",Door:"#adb5bd",Kill:"#e63946",Task:"#2ec4b6",Meeting:"#ffd60a",Emergency:"#f94144",Default:"#94a3b8"},P=[{pattern:/reactor|meltdown/i,key:"Reactor"},{pattern:/o2/i,key:"O2"},{pattern:/light/i,key:"Lights"},{pattern:/comm|communication/i,key:"Communications"},{pattern:/crash/i,key:"CrashCourse"},{pattern:/mushroom/i,key:"Mushroom"},{pattern:/door/i,key:"Door"}],O={Task:"Task",Sabotage:"Reactor",Combat:"Kill",Meeting:"Meeting",MeetingControl:"Emergency"},R=new Set(["Kill","Sabotage","EmergencyButton","Meeting"]);function S(e){return{value:e.uuid,label:e.name,colorId:e.colorId,platform:e.platform}}function E(e){return e instanceof DOMException?"AbortError"===e.name:e?.name==="AbortError"}var T=e.i(72984);function I({loading:e}){return(0,t.jsxs)("header",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Among Us Analytics"}),(0,t.jsx)("h1",{className:"mt-1 text-3xl font-semibold text-slate-900",children:"Beyond Us ライトテーマダッシュボード"}),(0,t.jsx)("p",{className:"mt-2 max-w-3xl text-sm text-slate-500",children:"JSONL ログをブラウザだけで読み込み、役職別パフォーマンスやヒートマップ、移動タイムラインなど 10 種類の Highcharts を一括で確認できます。"})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-3 text-sm",children:e?(0,t.jsx)("span",{className:"rounded-full bg-slate-200 px-4 py-2 font-medium text-slate-600",children:"読み込み中..."}):null})]})}function F({label:e,options:l,selectedValues:s,onChange:r,className:n=""}){let[i,o]=(0,a.useState)(!1),d=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let c=e=>{let t=e.target.value;e.target.checked?r([...s,t]):r(s.filter(e=>e!==t))},m=0===s.length?"選択なし":s.length===l.length?"すべて選択中":s.length<=3?l.filter(e=>s.includes(e.value)).map(e=>e.label).join(", "):`${s.length} 件選択中`;return(0,t.jsxs)("div",{className:`flex flex-col ${n}`,ref:d,children:[(0,t.jsx)("span",{className:"mb-2 text-sm font-semibold text-slate-700",children:e}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>o(!i),className:`flex w-full items-center justify-between rounded-xl border bg-white px-3 py-2.5 text-left text-sm shadow-sm transition-all ${i?"border-indigo-500 ring-2 ring-indigo-100":"border-slate-200 hover:border-slate-300"}`,children:[(0,t.jsx)("span",{className:0===s.length?"text-slate-400":"text-slate-700",children:m}),(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:`h-5 w-5 text-slate-400 transition-transform ${i?"rotate-180":""}`,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i&&(0,t.jsxs)("div",{className:"absolute left-0 top-full z-20 mt-2 w-full rounded-xl border border-slate-200 bg-white p-2 shadow-lg ring-1 ring-black/5",children:[(0,t.jsx)("div",{className:"mb-2 flex justify-end px-2",children:(0,t.jsx)("button",{type:"button",onClick:()=>{s.length===l.length?r([]):r(l.map(e=>e.value))},"aria-pressed":s.length===l.length,className:"inline-flex items-center gap-2 rounded-md px-3 py-1.5 text-sm font-medium text-slate-700 bg-slate-50 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-100",children:s.length===l.length?"全解除":"全選択"})}),(0,t.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-1",children:l.map(e=>(0,t.jsxs)("label",{className:"flex cursor-pointer items-center gap-2 rounded-lg px-2 py-1.5 hover:bg-slate-50",children:[(0,t.jsx)("input",{type:"checkbox",value:e.value,checked:s.includes(e.value),onChange:c,className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"}),(0,t.jsx)("span",{className:"text-sm text-slate-700",children:e.label})]},e.value))})]})]})]})}function G({selectedGameIds:e,selectedPlayerIds:l,gameOptions:s,playerOptions:r,recentGamesCount:n,onGameChange:i,onPlayerChange:o,onRecentGamesChange:d,resetFilters:c}){let[m,u]=(0,a.useState)("all"),[p,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)(""),x=null!==n&&![5,10,20,50].includes(n),y=p||x,b=(0,a.useMemo)(()=>e.length>0?"manual":null!==n?"recent":m,[e.length,n,m]),v=e=>{let t=e.map(e=>({value:e,selected:!0}));i({target:{selectedOptions:t,options:t,value:e[0]}})},j=e=>{u(e),"all"===e?(v([]),d(null)):"recent"===e?(v([]),null===n&&d(5)):"manual"===e&&d(null)};return(0,t.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md",children:[(0,t.jsxs)("div",{className:"grid gap-8 lg:grid-cols-2",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center gap-2 text-slate-700",children:[(0,t.jsx)("span",{className:"text-slate-400",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-5 w-5",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v9a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 00-2 0v1H7V3a1 1 0 00-1-1zM4 9h12v5H4V9z",clipRule:"evenodd"})})}),(0,t.jsx)("span",{className:"font-bold tracking-tight",children:"試合の絞り込み"})]}),(0,t.jsxs)("div",{className:"mb-4 flex rounded-lg bg-slate-100 p-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>j("all"),className:`flex-1 rounded-md py-1.5 text-sm font-medium transition-all ${"all"===b?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"全期間"}),(0,t.jsx)("button",{type:"button",onClick:()=>j("recent"),className:`flex-1 rounded-md py-1.5 text-sm font-medium transition-all ${"recent"===b?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"直近の試合"}),(0,t.jsx)("button",{type:"button",onClick:()=>j("manual"),className:`flex-1 rounded-md py-1.5 text-sm font-medium transition-all ${"manual"===b?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"個別に選択"})]}),"recent"===b&&(0,t.jsxs)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("select",{value:y||null!==n&&![5,10,20,50].includes(n)?"custom":null!==n?String(n):"",onChange:e=>{let t=e.target.value;if("custom"===t)h(!0),f(""),setTimeout(()=>{let e=document.getElementById("custom-recent-games");e?.focus()},0);else if(""===t)h(!1),d(null);else{h(!1);let e=parseInt(t,10);Number.isNaN(e)||d(e)}},className:"flex-1 rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm shadow-sm transition-all hover:border-slate-300 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-100",children:[(0,t.jsx)("option",{value:"",children:"指定なし"}),(0,t.jsx)("option",{value:"5",children:"直近 5 試合"}),(0,t.jsx)("option",{value:"10",children:"直近 10 試合"}),(0,t.jsx)("option",{value:"20",children:"直近 20 試合"}),(0,t.jsx)("option",{value:"50",children:"直近 50 試合"}),(0,t.jsx)("option",{value:"custom",children:"カスタム"})]}),y&&(0,t.jsx)("input",{id:"custom-recent-games",type:"number",min:"1",value:g||x&&String(n)||"",onChange:e=>{let t=e.target.value;if(f(t),t){let e=parseInt(t,10);e>0&&d(e)}else d(null)},placeholder:"数値を入力",className:"w-24 rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm shadow-sm transition-all hover:border-slate-300 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-100"})]}),(0,t.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:y||null!==n&&![5,10,20,50].includes(n)?`最新 ${g||n} 試合のデータが表示されます`:n?`最新 ${n} 試合のデータが表示されます`:"試合数を選択してください"})]}),"manual"===b&&(0,t.jsxs)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,t.jsx)(F,{label:"試合一覧",options:s,selectedValues:e,onChange:v}),(0,t.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"ドロップダウンを開いて選択します。"})]}),"all"===b&&(0,t.jsx)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:(0,t.jsx)("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-3 text-center text-sm text-slate-500",children:"すべての試合データが表示されます"})})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center gap-2 text-slate-700",children:[(0,t.jsx)("span",{className:"text-slate-400",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-5 w-5",children:(0,t.jsx)("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})})}),(0,t.jsx)("span",{className:"font-bold tracking-tight",children:"プレイヤーを選択"})]}),(0,t.jsx)(F,{label:"プレイヤー一覧",options:r,selectedValues:l,onChange:e=>{let t=e.map(e=>({value:e,selected:!0}));o({target:{selectedOptions:t,options:t,value:e[0]}})}}),(0,t.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"ドロップダウンを開いて選択します。"})]})]}),(0,t.jsx)("div",{className:"mt-4 flex justify-end",children:(0,t.jsx)("button",{type:"button",onClick:()=>{c(),u("all"),h(!1),f("")},className:"rounded-full border border-transparent bg-slate-900 px-4 py-2 font-medium text-white shadow-sm transition hover:bg-slate-800",children:"フィルタをクリア"})})]})}function z({label:e,value:a,helper:l}){return(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white/90 px-4 py-3 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:e}),(0,t.jsx)("p",{className:"mt-1 text-2xl font-semibold text-slate-900",children:a}),l?(0,t.jsx)("p",{className:"text-xs text-slate-500",children:l}):null]})}function L({kpiCards:e}){return(0,t.jsx)("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:e.map(e=>(0,t.jsx)(z,{label:e.label,value:e.value,helper:e.helper},e.label))})}var D=e.i(70703);function $({title:e,description:a,actions:l,footer:s,children:r,className:n,span:i}){let o=["rounded-3xl border border-slate-200 bg-white/90 p-6 shadow-sm backdrop-blur","flex flex-col gap-4",i,n].filter(Boolean).join(" ");return(0,t.jsxs)("section",{className:o,"data-testid":"card",children:[(e||l)&&(0,t.jsxs)("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[e?(0,t.jsx)("h3",{className:"text-base font-semibold text-slate-900",children:e}):null,a?(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:a}):null]}),l?(0,t.jsx)("div",{className:"text-sm text-slate-500",children:l}):null]}),(0,t.jsx)("div",{className:"min-h-[280px] flex-1",children:r}),s?(0,t.jsx)("footer",{className:"border-t border-slate-100 pt-3 text-xs text-slate-500",children:s}):null]})}function B({title:e,description:a,actions:l,footer:s,children:r,className:n,span:i}){return(0,t.jsx)($,{title:e,description:a,actions:l,footer:s,className:["relative",n].filter(Boolean).join(" "),span:i,children:r})}let W=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerWinRateChart),{loadableGenerated:{modules:[25811]},ssr:!1}),H=(0,D.default)(()=>e.A(6745).then(e=>e.RoleWinRateChart),{loadableGenerated:{modules:[25811]},ssr:!1}),K=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerFactionPlayRateChart),{loadableGenerated:{modules:[25811]},ssr:!1}),U=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerRolePlayRateChart),{loadableGenerated:{modules:[25811]},ssr:!1}),q=(0,D.default)(()=>e.A(6745).then(e=>e.FactionWinRateChart),{loadableGenerated:{modules:[25811]},ssr:!1}),V=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerFactionHeatmap),{loadableGenerated:{modules:[25811]},ssr:!1}),J=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerRoleHeatmap),{loadableGenerated:{modules:[25811]},ssr:!1}),Z=(0,D.default)(()=>e.A(6745).then(e=>e.TaskTimelineChart),{loadableGenerated:{modules:[25811]},ssr:!1}),X=(0,D.default)(()=>e.A(6745).then(e=>e.EventDensityChart),{loadableGenerated:{modules:[25811]},ssr:!1}),Q=(0,D.default)(()=>e.A(6745).then(e=>e.MovementWithEventsChart),{loadableGenerated:{modules:[25811]},ssr:!1}),Y=(0,D.default)(()=>e.A(6745).then(e=>e.RolePerformanceChart),{loadableGenerated:{modules:[25811]},ssr:!1}),ee=(0,D.default)(()=>e.A(6745).then(e=>e.GameDurationChart),{loadableGenerated:{modules:[25811]},ssr:!1}),et=(0,D.default)(()=>e.A(6745).then(e=>e.PlayerStatsTable),{loadableGenerated:{modules:[25811]},ssr:!1});function ea({analytics:e,games:a,selectedGameIds:l,selectedPlayerIds:s}){let r={games:a,selectedGameIds:l.length>0?new Set(l):void 0,selectedPlayerIds:s.length>0?new Set(s):void 0};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B,{title:"プレイヤー勝率",description:"プレイヤーごとの勝率",span:"lg:col-span-12",children:(0,t.jsx)(W,{data:e.playerWinRate,className:"h-96"})}),(0,t.jsx)(B,{title:"役職別勝敗率",description:"各役職の勝敗率",span:"lg:col-span-12",children:(0,t.jsx)(H,{data:e.rolePerformance,className:"h-96"})}),(0,t.jsx)(B,{title:"陣営別勝率",description:"勝利数・試合数を割合で把握",span:"lg:col-span-12",children:(0,t.jsx)(q,{data:e.factionWinRate,className:"h-96"})}),(0,t.jsxs)("section",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[(0,t.jsx)(B,{title:"プレイヤーの陣営プレイ率",description:"全プレイヤーの陣営プレイ割合",span:"lg:col-span-12",children:(0,t.jsx)(K,{options:r})}),(0,t.jsx)(B,{title:"プレイヤーの役職ごとのプレイ率",description:"全プレイヤーの役職プレイ割合",span:"lg:col-span-12",children:(0,t.jsx)(U,{options:r})}),(0,t.jsx)(B,{title:"プレイヤー × 陣営ヒートマップ",description:"勝率とプレイ回数",span:"lg:col-span-12",children:(0,t.jsx)(V,{data:e.playerFactionHeatmap,className:"min-h-[400px]"})}),(0,t.jsx)(B,{title:"プレイヤー × 役職ヒートマップ",description:"勝率とプレイ回数（全役職を含む。プレイ回数が0の役職は非表示）",span:"lg:col-span-12",children:(0,t.jsx)(J,{data:e.playerRoleHeatmap,className:"min-h-[400px]"})}),(0,t.jsx)(B,{title:"プレイヤー統計一覧",description:"全プレイヤーの集計統計（試合数, 勝利, キルなど）。列はプレイヤー、行は指標です。",span:"lg:col-span-12",children:(0,t.jsx)(et,{data:e.playerAllStats})}),(0,t.jsx)(B,{title:"タスク進捗タイムライン",description:"累計タスク数の推移",span:"lg:col-span-7",children:(0,t.jsx)(Z,{data:e.taskTimeline,className:"h-90"})}),(0,t.jsx)(B,{title:"イベント密度",description:"分単位のイベント発生数",span:"lg:col-span-5",children:(0,t.jsx)(X,{data:e.eventDensity,className:"h-90"})}),(0,t.jsx)(B,{title:"移動距離 × イベント",description:"プレイヤー別の移動量と重要イベント",span:"lg:col-span-8",children:(0,t.jsx)(Q,{data:e.movementWithEvents,className:"h-95"})}),(0,t.jsx)(B,{title:"役職別パフォーマンス",description:"タスク完了率・平均生存時間",span:"lg:col-span-6",children:(0,t.jsx)(Y,{data:e.rolePerformance,className:"h-105"})}),(0,t.jsx)(B,{title:"試合時間分布",description:"所要時間の分布",span:"lg:col-span-6",children:(0,t.jsx)(ee,{data:e.gameDuration,className:"h-105"})})]})]})}function el(){let{loading:e,error:l,parserErrors:s,gameOptions:r,playerOptions:p,filters:h,analytics:g,refresh:f,hasData:x,games:y}=function(){let[e,t]=(0,a.useState)([]),[l,s]=(0,a.useState)(!0),[r,p]=(0,a.useState)(null),[h,g]=(0,a.useState)([]),[f,x]=(0,a.useState)([]),[y,b]=(0,a.useState)([]),[v,j]=(0,a.useState)(null),w=(0,a.useMemo)(()=>new Set(f),[f]),N=(0,a.useMemo)(()=>new Set(y),[y]),k=(0,a.useMemo)(()=>{if(null!==v&&!(v<=0))return new Set(e.slice(-v).map(e=>e.schema.game_id))},[e,v]),C=(0,a.useMemo)(()=>({games:e,selectedGameIds:w.size>0?w:k&&k.size>0?k:void 0,selectedPlayerIds:N.size>0?N:void 0}),[e,w,N,k]),_=(0,a.useMemo)(()=>(0,d.buildPlayerDirectory)(e),[e]),T=(0,a.useMemo)(()=>e.map(e=>{let t,a;return{value:e.schema.game_id,label:(a=Number.isNaN((t=new Date(e.match.start_time)).getTime())?e.match.start_time:t.toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),`#${e.schema.game_count} ${e.match.map_name} \xb7 ${a}`),mapName:e.match.map_name,startTime:e.match.start_time,durationSeconds:e.match.duration_seconds,playerCount:e.match.player_count}}),[e]),I=(0,a.useMemo)(()=>Array.from(_.values()).map(S).sort((e,t)=>e.label.localeCompare(t.label,"ja")),[_]),F=(0,a.useMemo)(()=>{let e,t,a,l,s,r,n,p,h,g,f,x,y,b,v,j,w,N,k;return{factionWinRate:(e=(0,d.applyCommonFilters)(C),t=c.reduce((e,t)=>(e[t]={wins:0,games:0},e),{}),e.forEach(e=>{let a;(a=new Set,Object.values(e.players.data).forEach(e=>{a.add((0,i.getRoleFaction)(e.role.main_role))}),0===a.size&&a.add("Other"),a).forEach(e=>{t[e].games+=1});let l=(0,i.getFactionFromWinnerTeam)(e.match.winner_team);t[l].wins+=1}),a=c.map(e=>{let a=t[e],l=Math.max(a.games-a.wins,0),s=a.games>0?a.wins/a.games:0;return{faction:e,wins:a.wins,games:a.games,losses:l,winRate:s,color:o.FACTION_COLORS[e]}}).filter(e=>e.games>0||e.wins>0),{totalGames:e.length,breakdown:a}),playerWinRate:(l=(0,d.applyCommonFilters)(C),(s=Array.from((0,d.buildPlayerAggregates)(l,C.selectedPlayerIds).values()).map(e=>{let t=e.appearances,a=t>0?e.wins/t:0;return{uuid:e.uuid,name:e.name,wins:e.wins,losses:e.losses,games:t,winRate:a,factions:Object.entries(e.factions).map(([e,t])=>({faction:e,wins:t.wins,games:t.games})),roles:Object.entries(e.roles).map(([e,t])=>({role:e,wins:t.wins,games:t.games}))}})).sort((e,t)=>t.winRate-e.winRate),{rows:s}),playerAllStats:(r=(0,d.applyCommonFilters)(C),(n=Array.from((0,d.buildPlayerAggregates)(r,C.selectedPlayerIds).values()).map(e=>({uuid:e.uuid,name:e.name,appearances:e.appearances,wins:e.wins,losses:e.losses,deaths:e.deaths,kills:e.kills,tasksCompleted:e.tasksCompleted,movementDistance:e.movementDistance,emergencyButtons:e.emergencyButtons,sabotagesTriggered:e.sabotagesTriggered,timeAlive:e.timeAlive,factions:Object.entries(e.factions).map(([e,t])=>({faction:e,games:t.games,wins:t.wins})),roles:Object.entries(e.roles).map(([e,t])=>({role:e,games:t.games,wins:t.wins}))}))).sort((e,t)=>t.appearances-e.appearances),{rows:n}),playerFactionHeatmap:(p=(0,d.applyCommonFilters)(C),g=(h=Array.from((0,d.buildPlayerAggregates)(p,C.selectedPlayerIds).values()).sort((e,t)=>e.name.localeCompare(t.name,"ja"))).flatMap((e,t)=>u.map((a,l)=>{let s=e.factions[a]??{wins:0,games:0},r=s.games,n=r>0?Number((s.wins/r*100).toFixed(1)):null,i=null!==n?(0,m.hexToRgba)(m.SINGLE_HEATMAP_COLOR,.25+n/100*.75):"#f8fafc";return{x:t,y:l,value:n,color:i,playCount:r,wins:s.wins,meta:{playerUuid:e.uuid,label:e.name,target:a}}})),{xAxis:h.map(e=>e.name),yAxis:u,cells:g}),playerRoleHeatmap:(f=(0,d.applyCommonFilters)(C),x=Array.from((0,d.buildPlayerAggregates)(f,C.selectedPlayerIds).values()).sort((e,t)=>e.name.localeCompare(t.name,"ja")),y=new Map,x.forEach(e=>{Object.entries(e.roles).forEach(([e,t])=>{y.set(e,(y.get(e)??0)+t.games)})}),b=Array.from(y.entries()).filter(([,e])=>e>0).sort((e,t)=>t[1]-e[1]).map(([e])=>e),v=x.flatMap((e,t)=>b.map((a,l)=>{let s=e.roles[a]??{wins:0,games:0},r=s.games,n=r>0?Number((s.wins/r*100).toFixed(1)):null,i=null!==n?(0,m.hexToRgba)(m.SINGLE_HEATMAP_COLOR,.25+n/100*.75):"#f8fafc";return{x:t,y:l,value:n,color:i,playCount:r,wins:s.wins,meta:{playerUuid:e.uuid,label:e.name,target:a}}})),{xAxis:x.map(e=>e.name),yAxis:b,cells:v}),rolePerformance:(j=(0,d.applyCommonFilters)(C),w=new Map,j.forEach(e=>{var t;return t=C.selectedPlayerIds,void Object.values(e.players.data).forEach(e=>{let a=(0,d.getPlayerKey)(e);if(t&&t.size>0&&!t.has(a))return;let l=e.role.main_role||"Unknown",s=w.get(l)??{role:l,games:0,wins:0,totalTasksCompleted:0,totalTasksAssigned:0,totalTimeAlive:0};s.games+=1,e.lifecycle.is_winner&&(s.wins+=1),s.totalTasksCompleted+=e.progression.tasks_completed??0,s.totalTasksAssigned+=e.progression.tasks_total??0,s.totalTimeAlive+=e.lifecycle.time_alive_seconds??0,w.set(l,s)})}),{rows:Array.from(w.values()).filter(e=>e.games>0).map(e=>{let t=(0,i.getRoleFaction)(e.role);return{role:e.role,faction:t,games:e.games,wins:e.wins,winRate:e.games>0?e.wins/e.games:0,taskCompletionRate:e.totalTasksAssigned>0?e.totalTasksCompleted/e.totalTasksAssigned:0,avgTimeAlive:e.games>0?e.totalTimeAlive/e.games:0}}).sort((e,t)=>t.games-e.games).slice(0,15)}),gameDuration:function(e){let t=(0,d.applyCommonFilters)(e).map(e=>e.match.duration_seconds??0).filter(e=>Number.isFinite(e)&&e>0),a=new Map;t.forEach(e=>{let t=3*Math.floor(Math.floor(e/60)/3);a.set(t,(a.get(t)??0)+1)});let l=Math.max(...Array.from(a.keys()),0),s=[];for(let e=0;e<=l;e+=3)s.push({minute:e,count:a.get(e)??0});let r=Math.floor(1.5),n=s.map(e=>e.count),i=n.map((e,t)=>{let a=Math.max(0,t-r),l=Math.min(n.length-1,t+r),s=n.slice(a,l+1);return s.reduce((e,t)=>e+t,0)/s.length});return{durations:t,distribution:s.map((e,t)=>({minute:e.minute,count:i[t]}))}}(C),taskTimeline:function(e){let t=(0,d.applyCommonFilters)(e)[0];if(!t)return null;let a=e.selectedPlayerIds,l=new Map;Object.values(t.players.data).forEach(e=>{l.set(e.identity.player_id,(0,d.getPlayerKey)(e))});let s=t.events.timeline.filter(e=>"TaskCompleted"===e.event_type).filter(e=>{if(!a||0===a.size||void 0===e.player_id)return!0;let t=l.get(e.player_id);return!!t&&a.has(t)}).map(e=>({elapsedSeconds:e.elapsed_time??0,totalTasksCompleted:e.total_tasks_completed??0,playerName:e.player_name??""})),r=Object.values(t.players.data).reduce((e,t)=>e+(t.progression.tasks_total??0),0);return{gameId:t.schema.game_id,points:s,taskTotal:r}}(C),eventDensity:(N=(0,d.applyCommonFilters)(C),k=new Map,N.forEach(e=>{let t,a=(t=new Map,Object.values(e.players.data).forEach(e=>{t.set(e.identity.player_id,(0,d.getPlayerKey)(e))}),t);e.events.timeline.forEach(e=>{var t,l;if(!function(e,t,a){if(!e||0===e.size)return!0;let l=[a.player_id,a.killer_id,a.victim_id,a.reporter_id].filter(e=>"number"==typeof e);return 0===l.length||l.some(a=>{let l=t.get(a);return!!l&&e.has(l)})}(C.selectedPlayerIds,a,e))return;let s=Math.floor((e.elapsed_time??0)/60),r=(t=e.category,"Kill"===(l=e.event_type)?"Combat":"EmergencyButton"===l||"MeetingControl"===t?"Emergency":"Meeting"===t?"Meeting":"Task"===t?"Task":"Sabotage"===t?"Sabotage":"Combat"===t?"Combat":t??l??"Other"),n=k.get(s)??{minute:s,categories:{}};n.categories[r]=(n.categories[r]??0)+1,k.set(s,n)})}),{buckets:Array.from(k.values()).sort((e,t)=>e.minute-t.minute)}),movementWithEvents:function(e){let t=(0,d.applyCommonFilters)(e)[0];if(!t)return null;let a=e.selectedPlayerIds,l=Object.values(t.players.data),s=l.filter(e=>!a||0===a.size||a.has((0,d.getPlayerKey)(e))).map(e=>{let a=(0,d.extractMoverSeries)(t,e).map(e=>({x:e.elapsed_time,y:e.cumulative_distance}));return{playerUuid:(0,d.getPlayerKey)(e),playerName:(0,d.getPlayerLabel)(e),data:a}}).filter(e=>e.data.length>0),r=new Map;return l.forEach(e=>{r.set(e.identity.player_id,(0,d.getPlayerKey)(e))}),{series:s,events:t.events.timeline.filter(e=>R.has(e.event_type??"")).filter(e=>(function(e,t,a){if(!t||0===t.size)return!0;let l=[a.player_id,a.killer_id,a.victim_id,a.reporter_id].filter(e=>"number"==typeof e);return 0===l.length||l.some(a=>{let l=e.get(a);return!!l&&t.has(l)})})(r,a,e)).map(e=>{let t,a,l,s=(t=function(e){if(!e)return null;let t=P.find(({pattern:t})=>t.test(e));return t?.key??null}(e.sabotage_type),a=e.category&&O[e.category],l="Default","Kill"===e.event_type?l="Kill":"EmergencyButton"===e.event_type?l="Emergency":"Meeting"===e.event_type?l="Meeting":"TaskCompleted"===e.event_type?l="Task":t?l=t:a&&(l=a),{key:l,icon:M[l],color:A[l],label:function(e){switch(e){case"CrashCourse":return"Crash Course";case"O2":return"O2 Depletion";case"Door":return"Door Sabotage";case"Reactor":return"Reactor Meltdown";default:return e}}(l)});return{x:e.elapsed_time??0,label:s.label,color:s.color,type:e.event_type??s.key}}),durationSeconds:t.match.duration_seconds??0}}(C)}},[C]),G=(0,a.useCallback)(()=>{x([]),b([]),j(null)},[]),z=(0,a.useCallback)(async e=>{s(!0),p(null);try{try{let a=await n({path:"game_history.jsonl",signal:e});if(a.games&&a.games.length>0){t(a.games),g(a.errors);return}}catch(e){if(E(e))return}try{let a=await n({signal:e});t(a.games),g(a.errors)}catch(e){if(E(e))return;p(e)}}finally{e?.aborted||s(!1)}},[]);(0,a.useEffect)(()=>{let e=new AbortController;return z(e.signal),()=>e.abort()},[z]);let L=(0,a.useCallback)(()=>{z()},[z]);return{loading:l,error:r,parserErrors:h,games:e,hasData:e.length>0,gameOptions:T,playerOptions:I,filters:{selectedGameIds:f,selectedPlayerIds:y,recentGamesCount:v,setSelectedGameIds:x,setSelectedPlayerIds:b,setRecentGamesCount:j,resetFilters:G},analytics:F,refresh:L}}(),b=g.factionWinRate.totalGames,v=g.gameDuration.durations.length?g.gameDuration.durations.reduce((e,t)=>e+t,0)/g.gameDuration.durations.length/60:0,j=g.playerWinRate.rows[0],w=[{label:"総試合数",value:(0,T.formatNumber)(b),helper:h.selectedGameIds.length>0?"フィルタ適用中":"全データ対象"},{label:"平均試合時間",value:(0,T.formatMinutes)(v),helper:"JSONLの平均値"},{label:"ユニークプレイヤー",value:(0,T.formatNumber)(p.length),helper:`${h.selectedPlayerIds.length||0} 名選択中`},{label:"最高勝率",value:j?(0,T.formatRatio)(j.winRate):"0%",helper:j?j.name:"データ不足"}];return(0,t.jsx)("main",{className:"min-h-screen bg-background pb-12",children:(0,t.jsxs)("div",{className:"mx-auto flex max-w-7xl flex-col gap-8 px-4 pt-10 lg:px-8",children:[(0,t.jsx)(I,{loading:e}),l?(0,t.jsxs)("div",{className:"rounded-3xl border border-rose-200 bg-rose-50/80 p-4 text-sm text-rose-900",children:[(0,t.jsx)("p",{className:"font-semibold",children:"データ取得に失敗しました"}),(0,t.jsx)("p",{className:"mt-1",children:l.message}),(0,t.jsx)("button",{type:"button",onClick:f,className:"mt-3 rounded-full border border-rose-200 bg-white/80 px-4 py-2 text-rose-700 hover:bg-white",children:"もう一度試す"})]}):null,s.length>0?(0,t.jsxs)("details",{className:"rounded-3xl border border-amber-200 bg-amber-50/80 p-4 text-sm text-amber-900",children:[(0,t.jsxs)("summary",{className:"cursor-pointer font-semibold",children:["JSONL 解析時に ",s.length," 件の警告が発生しました"]}),(0,t.jsx)("ul",{className:"mt-3 space-y-1",children:s.slice(0,3).map((e,a)=>(0,t.jsxs)("li",{children:["行 ",e.lineNumber,": ",e.error.message]},`${e.lineNumber}-${a}`))}),s.length>3?(0,t.jsxs)("p",{className:"mt-2 text-xs",children:["他 ",s.length-3," 件の警告があります。"]}):null]}):null,(0,t.jsx)(L,{kpiCards:w}),(0,t.jsx)(G,{selectedGameIds:h.selectedGameIds,selectedPlayerIds:h.selectedPlayerIds,gameOptions:r,playerOptions:p,recentGamesCount:h.recentGamesCount,onGameChange:e=>{let t=Array.from(e.target.selectedOptions).map(e=>e.value);h.setSelectedGameIds(t)},onPlayerChange:e=>{let t=Array.from(e.target.selectedOptions).map(e=>e.value);h.setSelectedPlayerIds(t)},onRecentGamesChange:h.setRecentGamesCount,resetFilters:h.resetFilters}),x||e?null:(0,t.jsx)("div",{className:"rounded-3xl border border-slate-200 bg-white/90 p-6 text-center text-slate-500",children:"まだ JSONL データが読み込まれていません。`public/game_history_sample.jsonl` を配置してください。"}),(0,t.jsx)(ea,{analytics:g,games:y,selectedGameIds:h.selectedGameIds,selectedPlayerIds:h.selectedPlayerIds})]})})}e.s(["default",()=>el],31713)}]);